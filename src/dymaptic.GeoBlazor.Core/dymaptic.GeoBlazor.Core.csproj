<Project Sdk="Microsoft.NET.Sdk.Razor">

    <PropertyGroup>
        <TargetFramework>net6.0</TargetFramework>
        <Nullable>enable</Nullable>
        <ImplicitUsings>enable</ImplicitUsings>
        <PackageId>dymaptic.GeoBlazor.Core</PackageId>
        <PackageTags>Blazor;ArcGIS;JsInterop;Javascript;Asp.NET</PackageTags>
        <Description>
            This package provides a Razor Component-based API for accessing ArcGIS maps, scenes, and data.
            It is a wrapper around the ArcGIS Javascript API - https://developers.arcgis.com/javascript/latest/
            For more information, contact dymaptic at info@dymaptic.com, or tim.purdum@dymaptic.com
        </Description>
        <PackageLicenseExpression>MIT</PackageLicenseExpression>
        <PackageVersion>1.1.0</PackageVersion>
        <Version>1.1.0</Version>
        <PackageVersion>1.1.0</PackageVersion>
        <Authors>Tim Purdum, Christopher Moravec</Authors>
        <Company>dymaptic</Company>
        <Copyright>Â©2022 by dymaptic</Copyright>
        <PackageReadmeFile>ReadMe.md</PackageReadmeFile>
        <RepositoryUrl>https://github.com/dymaptic/GeoBlazor</RepositoryUrl>
        <PackageProjectUrl>https://github.com/dymaptic/GeoBlazor</PackageProjectUrl>
        <RepositoryType>git</RepositoryType>
        <PackageIcon>dymaptic_logo.png</PackageIcon>
        <GeneratePackageOnBuild>true</GeneratePackageOnBuild>
        <GenerateDocumentationFile>true</GenerateDocumentationFile>
    </PropertyGroup>

    <ItemGroup>
        <SupportedPlatform Include="browser" />
    </ItemGroup>

    <ItemGroup>
        <PackageReference Include="DefaultDocumentation" Version="0.8.2" PrivateAssets="all" />
        <PackageReference Include="Microsoft.AspNetCore.Components.Web" Version="6.0.6" />
        <PackageReference Include="Microsoft.Extensions.Configuration" Version="6.0.1" />
    </ItemGroup>
    <PropertyGroup>
        <DefaultDocumentationFolder>Documentation</DefaultDocumentationFolder>
        <DefaultDocumentationGeneratedPages>Types</DefaultDocumentationGeneratedPages>
        <DefaultDocumentationGeneratedAccessModifiers>Public</DefaultDocumentationGeneratedAccessModifiers>
    </PropertyGroup>

    <ItemGroup>
        <None Include="dymaptic_logo.png" Pack="true" PackagePath="" />
        <Content Remove="package.json" />
        <Content Remove="package-lock.json" />
        <Content Remove="tsconfig.json" />
        <Content Include="package.json" Pack="false" />
        <Content Include="package-lock.json" Pack="false" />
        <Content Include="tsconfig.json" Pack="false" />
        <None Include="Scripts/arcGisJsInterop.ts" Pack="true" PackagePack="Scripts" />
        <None Include="Scripts/definitions.d.ts" Pack="true" PackagePack="Scripts" />
        <None Remove="ReadMe.md" />
        <None Include="ReadMe.md" Pack="true" PackagePath="" />
    </ItemGroup>

    <ItemGroup>
        <Folder Include="wwwroot\js" />
    </ItemGroup>

    <Target Name="Copy Readme" AfterTargets="PreBuildEvent">
        <Exec ContinueOnError="true" Command="robocopy ../../ ./ ReadMe.md /it" />
    </Target>

    <Target Name="NPM Install" AfterTargets="Copy Readme">
        <Exec Command="npm install" />
    </Target>

    <Target Name="NPM Debug Build" AfterTargets="NPM Install" Condition="$(Configuration) == 'DEBUG'">
        <Exec Command="npm run debugBuild" />
    </Target>
    <Target Name="NPM Release Build" AfterTargets="NPM Install" Condition="$(Configuration) == 'RELEASE'">
        <Exec Command="npm run releaseBuild" />
    </Target>
    
    <Target Name="Copy Documentation" AfterTargets="Build">
        <Exec Command="pwsh .\docCopy.ps1" />
    </Target>

    <Target Name="Move Nuget" AfterTargets="Publish">
        <Exec ContinueOnError="true" ConsoleToMSBuild="true" Command="robocopy bin/$(Configuration) ../../packages dymaptic.GeoBlazor.Core.$(Version).nupkg /it">
            <Output TaskParameter="ExitCode" PropertyName="ErrorCode" />
        </Exec>
        <Error Condition="$(ErrorCode) &gt; 8" Message="Robocopy failed" />
    </Target>
</Project>
