@inherits TestRunnerBase

@{
    base.BuildRenderTree(__builder);
}

@code {

    [TestMethod]
    public async Task TestCanRenderGeneratedMeasurementWidget(Action renderHandler)
    {
        MeasurementWidget? measurementWidget = null;

        AddMapRenderFragment(
            @<MapView class="map-view" OnViewRendered="renderHandler">
                <Map>
                    <Basemap>
                        <BasemapStyle Name="BasemapStyleName.ArcgisTopographic" />
                    </Basemap>
                </Map>
                <MeasurementWidget 
                    ActiveTool="@(ActiveTool.Area)"
                    AreaUnit="@(SystemOrAreaUnit.Imperial)"
                    Icon="@("et")"
                    Label="@("quo")"
                    LinearUnit="@(SystemOrLengthUnit.Feet)"
                    WidgetId="@("pariatur")">
                    <MeasurementViewModel 
                        ActiveTool="@(ActiveTool.Area)"
                        ActiveViewModel="@(new AreaMeasurement2DViewModel(SystemOrAreaUnit.Metric,
                            [SystemOrAreaUnit.Metric]))"
                        AreaUnit="@(SystemOrAreaUnit.Imperial)"
                        LinearUnit="@(SystemOrLengthUnit.Yards)">
                    </MeasurementViewModel>
                </MeasurementWidget>
            </MapView>);
        await WaitForMapToRender();
        Assert.IsNotNull(measurementWidget!);
        await AssertJavaScript("assertWidgetExists", args: "measurement");
        await measurementWidget.Clear();
        await measurementWidget.StartMeasurement();
        ActiveTool testActiveTool = ActiveTool.Distance;
        await measurementWidget.SetActiveTool(testActiveTool);
        var activeTool = await measurementWidget.GetActiveTool();
        Assert.AreEqual(testActiveTool, activeTool);
        SystemOrAreaUnit testAreaUnit = SystemOrAreaUnit.Imperial;
        await measurementWidget.SetAreaUnit(testAreaUnit);
        var areaUnit = await measurementWidget.GetAreaUnit();
        Assert.AreEqual(testAreaUnit, areaUnit);
        SystemOrLengthUnit testLinearUnit = SystemOrLengthUnit.Decimeters;
        await measurementWidget.SetLinearUnit(testLinearUnit);
        var linearUnit = await measurementWidget.GetLinearUnit();
        Assert.AreEqual(testLinearUnit, linearUnit);
        MeasurementViewModel testViewModel = new MeasurementViewModel(ActiveTool.Distance,
                new AreaMeasurement2DViewModel(SystemOrAreaUnit.Imperial,
                    [SystemOrAreaUnit.Metric]),
                SystemOrAreaUnit.Imperial,
                SystemOrLengthUnit.Millimeters);
        await measurementWidget.SetViewModel(testViewModel);
        var viewModel = await measurementWidget.GetViewModel();
        Assert.AreEqual(testViewModel, viewModel);
    }
}
