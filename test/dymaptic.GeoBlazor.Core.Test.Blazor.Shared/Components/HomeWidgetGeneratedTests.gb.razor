@inherits TestRunnerBase

@{
    base.BuildRenderTree(__builder);
}

@code {

    [TestMethod]
    public async Task TestCanRenderGeneratedHomeWidget(Action renderHandler)
    {
        HomeWidget? homeWidget = null;

        HomeGoEvent? goResult = null;
        void OnGo(HomeGoEvent result)
        {
            goResult = result;
        }
        AddMapRenderFragment(
            @<MapView class="map-view" OnViewRendered="renderHandler">
                <Map>
                    <Basemap>
                        <BasemapStyle Name="BasemapStyleName.ArcgisTopographic" />
                    </Basemap>
                </Map>
                <HomeWidget 
                    GoToOverride="@(new GoToOverride())"
                    Icon="@("commodi")"
                    Label="@("fugiat")"
                    UiStrings="@("rem")"
                    ViewModel="@(new HomeViewModel(new GoToOverride(),
                        new Viewpoint(new Polyline([new MapPath([new MapPoint([320.4120]),
                                    new MapPoint([611.7048,
                                        359.0952])]),
                                    new MapPath([new MapPoint([252.7448])])],
                                new SpatialReference(5,
                                        "nemo",
                                        "dolore",
                                        "et"),
                                    true,
                                    true),
                                49497628.6647,
                                22.1412,
                            new Camera(710.2290,
                                    569.1338,
                                new CameraLayout(781.4650,
                                        111.7430,
                                        117.9794,
                                        205.3571),
                                new Point(100.9657,
                                        60.5945,
                                        130.2986,
                                        7.3275,
                                        790.9909,
                                    new SpatialReference(1,
                                            "non",
                                            "officiis",
                                            "sint"),
                                        true,
                                        true,
                                        710.2915),
                                    491.9557))))"
                    WidgetId="@("officiis")"
                    OnGo="OnGo">
                    <Viewpoint 
                        TargetGeometry="@(new Polyline([new MapPath([new MapPoint([149.1559,
                                    342.0369]),
                                new MapPoint([602.1111])])],
                            new SpatialReference(3,
                                    "placeat",
                                    "a",
                                    "itaque"),
                                true,
                                true))"
                        Scale="@(16366816.5060)"
                        Rotation="@(94.9778)"
                        Camera="@(new Camera(23.7581,
                                821.1847,
                            new CameraLayout(645.6820,
                                    440.6798,
                                    875.9796,
                                    649.4070),
                            new Point(143.2853,
                                    -14.1054,
                                    -20.5136,
                                    -19.2759,
                                    953.4986,
                                new SpatialReference(4,
                                        "quidem",
                                        "totam",
                                        "non"),
                                    true,
                                    true,
                                    306.6121),
                                30.3261))">
                    </Viewpoint>
                </HomeWidget>
            </MapView>);
        await WaitForMapToRender();
        Assert.IsNotNull(homeWidget!);
        await AssertJavaScript("dispatchEvent", args: [homeWidget!.Id, "go"]);
        int tries = 100;
        while (tries > 0 &&
            (goResult is null))
        {
            await Task.Delay(100);
            tries--;
        }
        Assert.IsInstanceOfType<HomeGoEvent>(goResult);
        await AssertJavaScript("assertWidgetExists", args: "home");
        await homeWidget.CancelGo();
        await homeWidget.Go();
        GoToOverride testGoToOverride = new GoToOverride();
        await homeWidget.SetGoToOverride(testGoToOverride);
        var goToOverride = await homeWidget.GetGoToOverride();
        Assert.AreEqual(testGoToOverride, goToOverride);
        HomeViewModel testViewModel = new HomeViewModel(new GoToOverride(),
                new Viewpoint(new Polyline([new MapPath([new MapPoint([485.5506])]),
                            new MapPath([new MapPoint([268.8538])])],
                        new SpatialReference(6,
                                "odio",
                                "alias",
                                "rerum"),
                            true,
                            true),
                        9026411.6823,
                        105.6386,
                    new Camera(249.2342,
                            548.2350,
                        new CameraLayout(264.9359,
                                559.9490,
                                52.7217,
                                93.6567),
                        new Point(-131.8588,
                                63.3004,
                                -88.2803,
                                85.9712,
                                629.7181,
                            new SpatialReference(5,
                                    "iste",
                                    "cum",
                                    "officiis"),
                                true,
                                true,
                                175.3532),
                            294.2808)));
        await homeWidget.SetViewModel(testViewModel);
        var viewModel = await homeWidget.GetViewModel();
        Assert.AreEqual(testViewModel, viewModel);
        Viewpoint testViewpoint = new Viewpoint(new Polyline([new MapPath([new MapPoint([632.5418,
                            383.1105]),
                        new MapPoint([400.5571])]),
                        new MapPath([new MapPoint([842.8871])])],
                    new SpatialReference(7,
                            "odit",
                            "dolorum",
                            "facilis"),
                        true,
                        true),
                    8387111.1665,
                    129.2220,
                new Camera(529.1492,
                        313.4970,
                    new CameraLayout(549.6769,
                            7.2150,
                            872.1880,
                            411.8329),
                    new Point(-120.0278,
                            -78.2960,
                            -47.4718,
                            -40.5986,
                            370.2024,
                        new SpatialReference(6,
                                "dolores",
                                "autem",
                                "vitae"),
                            true,
                            true,
                            352.2797),
                        492.0127));
        await homeWidget.SetViewpoint(testViewpoint);
        var viewpoint = await homeWidget.GetViewpoint();
        Assert.AreEqual(testViewpoint, viewpoint);
    }
}
