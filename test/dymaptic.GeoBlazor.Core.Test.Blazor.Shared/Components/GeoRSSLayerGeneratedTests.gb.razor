@inherits TestRunnerBase

@{
    base.BuildRenderTree(__builder);
}

@code {

    [TestMethod]
    public async Task TestCanRenderGeoRSSLayer(Action renderHandler)
    {
        GeoRSSLayer? geoRSSLayer = null;

        RefreshEvent? refreshResult = null;
        void OnRefresh(RefreshEvent result)
        {
            refreshResult = result;
        }
        AddMapRenderFragment(
            @<MapView class="map-view" OnViewRendered="renderHandler">
                <Map>
                    <Basemap>
                        <BasemapStyle Name="BasemapStyleName.ArcgisTopographic" />
                    </Basemap>
                    <GeoRSSLayer 
                        Url="@("https://arcgis.github.io/arcgis-samples-javascript/sample-data/layers-georss/sample-georss.xml")"
                        Title="@("illo sit velit")"
                        Opacity="@(0.1272)"
                        Visible="@(true)"
                        ListMode="@(ListMode.Hide)"
                        BlendMode="@(BlendMode.Plus)"
                        Effect="@(new Effect("qui",
                            47968675.4201))"
                        FullExtent="@(new Extent(36.7725,
                                41.3815,
                                71.4915,
                                -85.0163,
                                638.2683,
                                368.9183,
                                647.1246,
                                831.6015,
                            new SpatialReference(3,
                                    "veniam",
                                    "tenetur",
                                    "eos"),
                                true,
                                true))"
                        LegendEnabled="@(true)"
                        MaxScale="@(3063189.9972)"
                        MinScale="@(18951.5491)"
                        PersistenceEnabled="@(true)"
                        RefreshInterval="@(107.1955)"
                        OnRefresh="OnRefresh">
                        <TimeExtent 
                            Start="@(new DateTime(2011, 10, 22, 21, 50, 54))"
                            End="@(new DateTime(2017, 1, 2, 0, 37, 40))">
                        </TimeExtent>
                        <SimpleFillSymbol 
                            Outline="@(new Outline(new MapColor(83, 138, 21),
                                new Dimension(196.8406),
                                SimpleLineSymbolStyle.LongDash,
                                Cap.Round,
                                Join.Miter,
                                new LineSymbolMarker(new MapColor(78, 138, 18),
                                    LinePlacement.End,
                                    LineSymbolMarkerStyle.Diamond),
                                782.4612))"
                            Color="@(new MapColor(96, 73, 154))"
                            Style="@(SimpleFillSymbolStyle.Cross)">
                        </SimpleFillSymbol>
                        <PictureMarkerSymbol 
                            Angle="@(899.3210)"
                            Color="@(new MapColor(35, 50, 190))"
                            Xoffset="@(new Dimension(959.5112))"
                            Yoffset="@(new Dimension(143.0873))">
                        </PictureMarkerSymbol>
                        <SimpleLineSymbol 
                            Color="@(new MapColor(4, 19, 158))"
                            Width="@(new Dimension(837.5719))"
                            Style="@(SimpleLineSymbolStyle.Dash)"
                            Cap="@(Cap.Round)"
                            Join="@(Join.Bevel)"
                            Marker="@(new LineSymbolMarker(new MapColor(28, 182, 151),
                                LinePlacement.End,
                                LineSymbolMarkerStyle.Square))"
                            MiterLimit="@(653.0111)">
                        </SimpleLineSymbol>
                    </GeoRSSLayer>
                </Map>
            </MapView>);
        await WaitForMapToRender();
        Assert.IsNotNull(geoRSSLayer!);
        await AssertJavaScript("dispatchEvent", args: [geoRSSLayer!.Id, "refresh"]);
        int tries = 100;
        while (tries > 0 &&
            (refreshResult is null))
        {
            await Task.Delay(100);
            tries--;
        }
        Assert.IsInstanceOfType<RefreshEvent>(refreshResult);
        await AssertJavaScript("assertLayerExists", args: "geo-rss");
        await geoRSSLayer.Refresh();
        ListMode testListMode = ListMode.Show;
        await geoRSSLayer.SetListMode(testListMode);
        var listMode = await geoRSSLayer.GetListMode();
        Assert.AreEqual(testListMode, listMode);
        BlendMode testBlendMode = BlendMode.DestinationOut;
        await geoRSSLayer.SetBlendMode(testBlendMode);
        var blendMode = await geoRSSLayer.GetBlendMode();
        Assert.AreEqual(testBlendMode, blendMode);
        Extent testFullExtent = new Extent(172.2387,
                    173.8341,
                    -88.7729,
                    33.1791,
                    248.2879,
                    168.7030,
                    623.5901,
                    390.0712,
                new SpatialReference(2,
                        "molestias",
                        "officia",
                        "cum"),
                    true,
                    true);
        await geoRSSLayer.SetFullExtent(testFullExtent);
        var fullExtent = await geoRSSLayer.GetFullExtent();
        Assert.AreEqual(testFullExtent, fullExtent);
        SimpleLineSymbol testLineSymbol = new SimpleLineSymbol(new MapColor(43, 56, 70),
                    new Dimension(430.5608),
                SimpleLineSymbolStyle.Dot,
                Cap.Square,
                Join.Bevel,
                new LineSymbolMarker(new MapColor(215, 69, 17),
                    LinePlacement.End,
                    LineSymbolMarkerStyle.Square),
                    835.9086);
        await geoRSSLayer.SetLineSymbol(testLineSymbol);
        var lineSymbol = await geoRSSLayer.GetLineSymbol();
        Assert.AreEqual(testLineSymbol, lineSymbol);
        MarkerSymbol testPointSymbol = new SimpleMarkerSymbol(new Outline(new MapColor(148, 105, 161),
                    new Dimension(202.3088),
                    SimpleLineSymbolStyle.LongDash,
                    Cap.Round,
                    Join.Miter,
                    new LineSymbolMarker(new MapColor(156, 101, 251),
                        LinePlacement.End,
                        LineSymbolMarkerStyle.Arrow),
                    366.5116),
                new MapColor(227, 163, 55),
                    new Dimension(349.0743),
                SimpleMarkerSymbolStyle.Circle,
                    795.5760,
                    new Dimension(192.4809),
                    new Dimension(193.0542),
                    "enim");
        await geoRSSLayer.SetPointSymbol(testPointSymbol);
        var pointSymbol = await geoRSSLayer.GetPointSymbol();
        Assert.AreEqual(testPointSymbol, pointSymbol);
        SimpleFillSymbol testPolygonSymbol = new SimpleFillSymbol(new Outline(new MapColor(41, 59, 182),
                    new Dimension(282.3933),
                    SimpleLineSymbolStyle.LongDash,
                    Cap.Round,
                    Join.Miter,
                    new LineSymbolMarker(new MapColor(12, 50, 193),
                        LinePlacement.End,
                        LineSymbolMarkerStyle.Cross),
                    511.7669),
                new MapColor(213, 9, 189),
                SimpleFillSymbolStyle.BackwardDiagonal);
        await geoRSSLayer.SetPolygonSymbol(testPolygonSymbol);
        var polygonSymbol = await geoRSSLayer.GetPolygonSymbol();
        Assert.AreEqual(testPolygonSymbol, polygonSymbol);
        TimeExtent testVisibilityTimeExtent = new TimeExtent(new DateTime(2000, 11, 26, 12, 3, 17),
                    new DateTime(2001, 1, 7, 15, 23, 10));
        await geoRSSLayer.SetVisibilityTimeExtent(testVisibilityTimeExtent);
        var visibilityTimeExtent = await geoRSSLayer.GetVisibilityTimeExtent();
        Assert.AreEqual(testVisibilityTimeExtent, visibilityTimeExtent);
    }
}
